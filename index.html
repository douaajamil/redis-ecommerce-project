<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Mini E-commerce</title>
<link rel="stylesheet" href="style.css">
</head>

<body>

<header>
  <h1>Mini Shop</h1>
  <p>Projet Redis — Licence 3 Informatique</p>
</header>

<section class="container">

<h2>Produits</h2>

<div class="products">

<div class="card">
  <h3>Produit 1</h3>
  <p class="price">10 €</p>
  <button onclick="addToCart('Produit 1',10)">Ajouter</button>
</div>

<div class="card">
  <h3>Produit 2</h3>
  <p class="price">20 €</p>
  <button onclick="addToCart('Produit 2',20)">Ajouter</button>
</div>

<div class="card">
  <h3>Produit 3</h3>
  <p class="price">70 €</p>
  <button onclick="addToCart('Produit 3',70)">Ajouter</button>
</div>

</div>

<div class="cart">
<h2>Panier</h2>

<ul id="cartList"></ul>

<p>Total : <span id="total">0</span> €</p>

<h3>Code promo</h3>
<input type="text" id="promoInput" placeholder="Entrer code promo">
<button onclick="applyPromo()">Appliquer</button>

<p id="promoMsg"></p>

</div>

</section>

<footer>© 2026 — Mini E-commerce Redis</footer>

<script>
let cart = [];
let total = 0;

// Promo
const PROMO_CODE = "SUMMER2026";
const PROMO_DURATION = 2 * 60 * 1000;


function addToCart(name, price) {
  cart.push({name, price});
  updateCart();
}

function removeItem(index) {
  cart.splice(index,1);
  updateCart();
}

function updateCart() {
  const list = document.getElementById("cartList");
  list.innerHTML = "";
  total = 0;

  cart.forEach((item, i) => {
    total += item.price;
    list.innerHTML += `<li>${item.name} - ${item.price} €
      <button onclick="removeItem(${i})">Supprimer</button></li>`;
  });

  document.getElementById("total").innerText = total;
}

// CODE PROMO SIMPLE
function applyPromo() {
  const input = document.getElementById("promoInput").value;
  const msg = document.getElementById("promoMsg");

  const used = localStorage.getItem("promo_used");
  const time = localStorage.getItem("promo_time");
  const now = new Date().getTime();

  // Déjà utilisé et encore valide
  if (used && time && now - parseInt(time) < PROMO_DURATION) {
    msg.style.color = "red";
    msg.innerText = "Code promo déjà utilisé.";
    return;
  }

  // Code valide
  if (input === PROMO_CODE) {
  localStorage.setItem("promo_used", "true");
  localStorage.setItem("promo_time", now);

  total = total * 0.9; // -10%

  document.getElementById("total").innerText = total.toFixed(2);

  msg.style.color = "green";
  msg.innerText = "Code promo appliqué avec succès (-10%).";
} else {
    msg.style.color = "red";
    msg.innerText = "Code promo invalide.";
  }
}
</script>

</body>
</html>
